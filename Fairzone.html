<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</title>
<link rel="icon" type="image/png" href="https://i.ibb.co/FbfJxWvn/logo.png">
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: "Cairo", sans-serif;
    direction: rtl;
    background: url("https://i.ibb.co/FbfJxWvn/logo.png") no-repeat center center fixed;
    background-size: cover;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  .container {
    background: rgba(255, 255, 255, 0.95);
    padding: 25px;
    border-radius: 15px;
    max-width: 420px;
    width: 90%;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  h2 { margin: 0 0 10px; font-size: 24px; color: #333; }
  input, button, .class-box {
    width: 100%;
    padding: 14px;
    margin: 10px 0;
    border: none;
    border-radius: 8px;
    font-size: 18px;
  }
  input { border: 1px solid #ccc; }
  button { background: #007BFF; color: #fff; font-weight: bold; cursor: pointer; }
  button:hover { background: #0056b3; }
  .class-box { background: #f0f0f0; cursor: pointer; font-weight: bold; }
  .class-box:hover { background: #ddd; }
  .suggestions { background: #fff; border: 1px solid #ccc; border-radius: 8px; max-height: 150px; overflow-y: auto; }
  .suggestions div { padding: 10px; cursor: pointer; }
  .suggestions div:hover { background: #eee; }
  .results { margin-top: 20px; display: flex; flex-direction: column; gap: 14px; }
  .result-row { display: flex; justify-content: space-between; align-items: center; }
  .label { flex: 1; text-align: right; font-weight: bold; color: #fff; margin-left: 10px; padding: 10px; border-radius: 8px; }
  .result-item { flex: 1.5; display: flex; justify-content: center; align-items: center; font-size: 18px; font-weight: bold; color: #fff; border-radius: 8px; min-height: 50px; }
  .blue { background: #4da6ff; } .red { background: #ff4d4d; } .green { background: #28a745; }
  @media (max-width: 768px) and (orientation: portrait) {
    h2 { font-size: 26px; }
    input, button, .class-box { font-size: 20px; padding: 16px; }
    .label, .result-item { font-size: 20px; min-height: 60px; }
  }
</style>
</head>
<body>
<div class="container" id="app">
  <h2>Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>

  <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginPage">
    <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¯Ù…Ù† -->
  <div id="adminChoice" style="display:none;">
    <h2>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¶Ø¹</h2>
    <button onclick="enterView()">ğŸ‘€ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    <button onclick="enterEdit()">âœ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
  </div>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ù‚Ø© -->
  <div id="classPage" style="display:none;">
    <h2>Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ù‚Ø©</h2>
    <div class="class-box" onclick="selectClass('1Ø¨')">1Ø¨</div>
    <div class="class-box" onclick="selectClass('2Ø¨')">2Ø¨</div>
    <div class="class-box" onclick="selectClass('3Ø¨')">3Ø¨</div>
    <div class="class-box" onclick="selectClass('4Ø¨')">4Ø¨</div>
    <div class="class-box" onclick="selectClass('5Ø¨')">5Ø¨</div>
    <div class="class-box" onclick="selectClass('6Ø¨')">6Ø¨</div>
  </div>

  <!-- Ø§Ù„Ø¨Ø­Ø« -->
  <div id="searchPage" style="display:none;">
    <h2>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
    <input type="text" id="nameInput" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
    <div id="suggestions" class="suggestions"></div>
    <button onclick="search()">Ø¨Ø­Ø«</button>
    <div class="results">
      <div class="result-row"><span class="label blue">Ø§Ù„Ø­Ø¶ÙˆØ± + Ø§Ù„ÙˆØ§Ø¬Ø¨</span><div id="B" class="result-item blue">â€”</div></div>
      <div class="result-row"><span class="label blue">Ø§Ù„ØªÙØ§Ø¹Ù„ + Ø§Ù„Ù‡Ø¯ÙˆØ¡</span><div id="D" class="result-item blue">â€”</div></div>
      <div class="result-row"><span class="label red">Ø§Ù„Ù€ Minus</span><div id="E" class="result-item red">â€”</div></div>
      <div class="result-row"><span class="label green">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span><div id="F" class="result-item green">â€”</div></div>
    </div>
    <button onclick="goBack()">â¬… Ø±Ø¬ÙˆØ¹</button>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
  <div id="editPage" style="display:none;">
    <h2>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
    <input type="text" id="editName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
    <div id="editSuggestions" class="suggestions"></div>
    <div style="text-align:right;">
      <label><input type="radio" name="field" value="interaction"> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ + Ø§Ù„Ù‡Ø¯ÙˆØ¡</label><br>
      <label><input type="radio" name="field" value="minus"> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ Minus</label>
    </div>
    <input type="number" id="newValue" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
    <button onclick="editData()">ØªØ¹Ø¯ÙŠÙ„</button>
    <button onclick="goBack()">â¬… Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<script>
const API_URL = "https://fairzone.johnmamdouh777.workers.dev/"; 
let allNames = [];
let selectedSheet = "";
let mode = "view";

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
function login() {
  const u = document.getElementById("username").value;
  const p = document.getElementById("password").value;
  if (u === "admin" && p === "123") {
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("adminChoice").style.display = "block";
  } else if (u === "user" && p === "123") {
    mode = "view";
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("classPage").style.display = "block";
  } else {
    alert("âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
  }
}

// Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù†
function enterView() {
  mode = "view";
  document.getElementById("adminChoice").style.display = "none";
  document.getElementById("classPage").style.display = "block";
}
function enterEdit() {
  mode = "edit";
  document.getElementById("adminChoice").style.display = "none";
  document.getElementById("classPage").style.display = "block";
}

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ù‚Ø©
function selectClass(sheet) {
  selectedSheet = sheet;
  document.getElementById("classPage").style.display = "none";
  if (mode === "view") {
    document.getElementById("searchPage").style.display = "block";
    loadNames("getNames"); // Ù…Ù† Ø§Ù„Ø´ÙŠØª Ø§Ù„Ù‚Ø¯ÙŠÙ…
  } else {
    document.getElementById("editPage").style.display = "block";
    loadNames("getEditNames"); // Ù…Ù† Ø§Ù„Ø´ÙŠØª Ø§Ù„Ø¬Ø¯ÙŠØ¯
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
function loadNames(action) {
  fetch(`${API_URL}?action=${action}&sheet=${encodeURIComponent(selectedSheet)}`)
    .then(res => res.json())
    .then(data => allNames = data.names || [])
    .catch(err => { console.error("Error loading names:", err); allNames = []; });
}

// Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
function showSuggestions(value, target, inputId) {
  const suggestions = document.getElementById(target);
  suggestions.innerHTML = "";
  if (!value || allNames.length === 0) return;
  allNames.filter(n => n.toLowerCase().includes(value.toLowerCase())).slice(0,5).forEach(n => {
    const div = document.createElement("div");
    div.textContent = n;
    div.onclick = () => { document.getElementById(inputId).value = n; suggestions.innerHTML = ""; };
    suggestions.appendChild(div);
  });
}
document.getElementById("nameInput").addEventListener("input", e => showSuggestions(e.target.value,"suggestions","nameInput"));
document.getElementById("editName").addEventListener("input", e => showSuggestions(e.target.value,"editSuggestions","editName"));

// Ø§Ù„Ø¨Ø­Ø«
function search() {
  const name = document.getElementById("nameInput").value;
  if (!allNames.includes(name)) { alert("âŒ Ø§Ø®ØªØ± Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª"); return; }
  fetch(`${API_URL}?action=getData&sheet=${encodeURIComponent(selectedSheet)}&name=${encodeURIComponent(name)}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("B").textContent = data.B || "â€”";
      document.getElementById("D").textContent = data.D || "â€”";
      document.getElementById("E").textContent = data.E || "â€”";
      document.getElementById("F").textContent = data.F || "â€”";
    });
}

// ØªØ¹Ø¯ÙŠÙ„
// ØªØ¹Ø¯ÙŠÙ„
function editData() {
  const name = document.getElementById("editName").value;
  const field = document.querySelector("input[name='field']:checked");
  const newValue = document.getElementById("newValue").value;

  if (!allNames.includes(name)) return alert("âŒ Ø§Ø®ØªØ± Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª");
  if (!field) return alert("âŒ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„");
  if (newValue === "") return alert("âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©");

  fetch(`${API_URL}?action=updateData&sheet=${encodeURIComponent(selectedSheet)}&name=${encodeURIComponent(name)}&field=${field.value}&value=${encodeURIComponent(newValue)}`)
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        alert("âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
        // ØªØµÙÙŠØ± Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª
        document.getElementById("editName").value = "";
        document.getElementById("newValue").value = "";
        document.getElementById("editSuggestions").innerHTML = "";
        document.querySelectorAll("input[name='field']").forEach(r => r.checked = false);
      } else {
        alert(data.error || "âŒ Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„");
      }
    })
    .catch(err => console.error("Error editing:", err));
}

// Ø±Ø¬ÙˆØ¹
function goBack() {
  if (document.getElementById("searchPage").style.display === "block" || document.getElementById("editPage").style.display === "block") {
    document.getElementById("searchPage").style.display = "none";
    document.getElementById("editPage").style.display = "none";
    document.getElementById("classPage").style.display = "block";
  } else if (document.getElementById("classPage").style.display === "block") {
    document.getElementById("classPage").style.display = "none";
    if (mode === "edit" || mode === "view") document.getElementById("adminChoice").style.display = "block";
    else document.getElementById("loginPage").style.display = "block";
  }
}
</script>
</body>
</html>
